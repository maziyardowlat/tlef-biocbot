<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BiocBot - Student Chat</title>
    
    <!-- Favicon - UBC Logo -->
    <link rel="icon" type="image/x-icon" href="../assets/images/favicon.ico">
    <link rel="icon" type="image/png" sizes="32x32" href="../assets/images/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="../assets/images/favicon-16x16.png">
    <link rel="apple-touch-icon" sizes="180x180" href="../assets/images/apple-touch-icon.png">
    <link rel="manifest" href="../assets/images/site.webmanifest">
    
    <link rel="stylesheet" href="../styles/style.css">
    <link rel="stylesheet" href="../styles/chat.css">
    <link rel="stylesheet" href="../styles/agreement-modal.css">
</head>
<body>
    <div class="app-container">
        <!-- Sidebar Navigation -->
        <aside class="sidebar">
            <div class="logo-container">
                <h2>BiocBot</h2>
            </div>
            <nav class="main-nav">
                <ul>
                    <li class="active"><a href="/student"><span class="icon"></span> Chat</a></li>
                    <li><a href="/student/history"><span class="icon"></span> Chat History</a></li>
                    <li><a href="/student/flagged"><span class="icon"></span> Flagged</a></li>
                    <li class="mobile-only-nav"><a href="#" id="mobile-logout-btn"><span class="icon"></span> Logout</a></li>
                </ul>
                <div class="new-session-container">
                    <button id="new-session-btn" class="new-session-button" title="Start a new chat session">
                        <span class="new-session-icon">+</span>
                        New Session
                    </button>
                </div>
            </nav>
            <div class="user-info">
                <div class="user-avatar">S</div>
                <div class="user-name" id="user-display-name">Student Name</div>
                <div class="user-role">Student - BIOC 202</div>
                <div class="user-actions">
                    <a href="#" id="logout-btn" class="user-action">Logout</a>
                </div>
            </div>
        </aside>

        <!-- Main Content Area -->
        <main class="main-content">
            <!-- Chat Header -->
            <header class="chat-header">
                <h1>Chat with BiocBot</h1>
                <div class="current-course">
                    <span class="course-label">Course:</span>
                    <span class="course-name">Select Course</span>
                </div>
                <!-- Unit Selection Dropdown -->
                <div class="unit-selection-container" id="unit-selection-container" style="display: none;">
                    <label for="unit-select" class="unit-label">Select Unit:</label>
                    <select id="unit-select" class="unit-select">
                        <option value="">Choose a unit...</option>
                    </select>
                </div>
            </header>

            <!-- Chat Messages Container -->
            <div class="chat-container">
                <div class="messages" id="chat-messages">
                    <!-- Initial State - Will be replaced by JS -->
                </div>

                <!-- Chat Input Area -->
                <div class="chat-input-container">
                    <form id="chat-form" autocomplete="off">
                        <input type="text" id="chat-input" placeholder="Type your message here..." autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="true" name="chat-message-input">
                        <button type="submit" id="send-button">Send</button>
                    </form>
                    <div class="chat-footer">
                        <div class="chat-disclaimer">
                            BiocBot can make mistakes. Verify important information with your instructor. Don't share personal information. <a href="#" id="view-rules-link" style="color: inherit; text-decoration: underline; margin-left: 8px;">View General Rules</a>
                        </div>
                        <!-- Mode Toggle -->
                        <div class="mode-toggle-container">
                            <div class="mode-toggle">
                                <span class="mode-label protege-label">Protégé</span>
                                <div class="toggle-switch">
                                    <input type="checkbox" id="mode-toggle-checkbox" checked>
                                    <label for="mode-toggle-checkbox" class="toggle-slider"></label>
                                </div>
                                <span class="mode-label tutor-label active">Tutor</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Idle Timeout Modal -->
    <div id="idle-timeout-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Are you still there?</h2>
            </div>
            <div class="modal-body">
                <p>You have been idle for a while.</p>
                <p>You will be automatically signed out in <span id="idle-countdown-display" style="font-weight: bold; color: var(--primary-color);">--:--</span>.</p>
            </div>
            <div class="modal-footer">
                <button id="idle-signout-btn" class="secondary-button">Sign Out</button>
                <button id="idle-stay-btn" class="primary-button">Confirm Stay</button>
            </div>
        </div>
    </div>

    <script src="../common/scripts/auth.js"></script>
    <script src="../common/scripts/agreement-modal.js"></script>
    <script src="./scripts/flag-notifications.js"></script>
    <script src="../common/scripts/mobile-layout.js"></script>
    <script src="../common/scripts/idle-timer.js"></script>
    <script src="./scripts/student.js"></script>
    <script>
        // Initialize flag notifications after DOM is ready
        document.addEventListener('DOMContentLoaded', async () => {
            // Wait a bit for auth to initialize
            setTimeout(async () => {
                try {
                    await initializeFlagNotifications();
                } catch (error) {
                    console.error('Error initializing flag notifications:', error);
                }
            }, 1000);
        });
    </script>
</body>
</html> 